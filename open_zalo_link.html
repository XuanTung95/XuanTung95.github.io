<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deeplink Auto Open</title>
</head>
<body>
    <h1>Copy URL to Clipboard</h1>
    <p>Click the button below to copy the current page URL:</p>
    <button onclick="openAppFromZaloIfNeeded()">Copy URL</button>
    <a href="https://beta.meeymap.com/tra-cuu-quy-hoach/phuoc-hoa?search=eyJsYXQiOiIxMS4yMzgwODQ0NTU4NjgwNzYiLCJsbmciOiIxMDYuNzIwMTE5MDE4NTkyNDciLCJ0YWIiOjIsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsImFkZHJlc3MiOiJQaMaw4bubYyBIb8OgLCBUeC4gQuG6v24gQ8OhdCwgQsOsbmggRMawxqFuZywgVmnhu4d0IE5hbSIsImltYWdlIjoiaHR0cHM6Ly9zdGF0aWN2My5tZWV5bWFwLmNvbS9pbWFnZV9jYXB0dXJlL2NhcHR1cmV0ZW1wX2ltYWdlMTczNDg0OTc2NC53ZWJwIn0&utm_source=zalo&utm_medium=zalo&utm_campaign=zalo" >A href = </a>
    <div class="btn01" onclick="test();return false;">Test()</div>
    <div class="copied" id="copiedText">URL Copied!</div>
    <button onclick="openAppFromZaloIfNeeded()">openMyLink</button>
    <a class="btn01" onclick="proceed();return false;">Tôi đã hiểu và tiếp tục</a>
    <script src="js/jquery-1.10.2.js"></script>
    <script src="https://stc-zalosdk.zdn.vn/zalojs-sdk-v2.min.js"></script>
    <script>
        function proceed() {
            var url = "https://beta.meeymap.com/tra-cuu-quy-hoach/phuoc-hoa?search=eyJsYXQiOiIxMS4yMzgwODQ0NTU4NjgwNzYiLCJsbmciOiIxMDYuNzIwMTE5MDE4NTkyNDciLCJ0YWIiOjIsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsImFkZHJlc3MiOiJQaMaw4bubYyBIb8OgLCBUeC4gQuG6v24gQ8OhdCwgQsOsbmggRMawxqFuZywgVmnhu4d0IE5hbSIsImltYWdlIjoiaHR0cHM6Ly9zdGF0aWN2My5tZWV5bWFwLmNvbS9pbWFnZV9jYXB0dXJlL2NhcHR1cmV0ZW1wX2ltYWdlMTczNDg0OTc2NC53ZWJwIn0&utm_source=zalo&utm_medium=zalo&utm_campaign=zalo";
            $.ajax({
                url : "/rp?url=https%3A%2F%2Fbeta.meeymap.com%2Ftra-cuu-quy-hoach%2Fphuoc-hoa%3Fsearch%3DeyJsYXQiOiIxMS4yMzgwODQ0NTU4NjgwNzYiLCJsbmciOiIxMDYuNzIwMTE5MDE4NTkyNDciLCJ0YWIiOjIsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsImFkZHJlc3MiOiJQaMaw4bubYyBIb8OgLCBUeC4gQuG6v24gQ8OhdCwgQsOsbmggRMawxqFuZywgVmnhu4d0IE5hbSIsImltYWdlIjoiaHR0cHM6Ly9zdGF0aWN2My5tZWV5bWFwLmNvbS9pbWFnZV9jYXB0dXJlL2NhcHR1cmV0ZW1wX2ltYWdlMTczNDg0OTc2NC53ZWJwIn0%26utm_source%3Dzalo%26utm_medium%3Dzalo%26utm_campaign%3Dzalo&key=0&oId=0&ac=go",
                type: "POST",
                data : "json"
            });
            fetch('/at?page=CONFIRM&action=PROCEED&key=0&url=https%3A%2F%2Fbeta.meeymap.com%2Ftra-cuu-quy-hoach%2Fphuoc-hoa%3Fsearch%3DeyJsYXQiOiIxMS4yMzgwODQ0NTU4NjgwNzYiLCJsbmciOiIxMDYuNzIwMTE5MDE4NTkyNDciLCJ0YWIiOjIsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsImFkZHJlc3MiOiJQaMaw4bubYyBIb8OgLCBUeC4gQuG6v24gQ8OhdCwgQsOsbmggRMawxqFuZywgVmnhu4d0IE5hbSIsImltYWdlIjoiaHR0cHM6Ly9zdGF0aWN2My5tZWV5bWFwLmNvbS9pbWFnZV9jYXB0dXJlL2NhcHR1cmV0ZW1wX2ltYWdlMTczNDg0OTc2NC53ZWJwIn0%26utm_source%3Dzalo%26utm_medium%3Dzalo%26utm_campaign%3Dzalo');
            
            window.location.href = url;
        }
        function closeWindow() {
            var access_token = zaloJSV2.getCookie('zaloapp.com_zacc_session');
            fetch('/at?page=CONFIRM&action=CLOSE&key=0&url=https%3A%2F%2Fbeta.meeymap.com%2Ftra-cuu-quy-hoach%2Fphuoc-hoa%3Fsearch%3DeyJsYXQiOiIxMS4yMzgwODQ0NTU4NjgwNzYiLCJsbmciOiIxMDYuNzIwMTE5MDE4NTkyNDciLCJ0YWIiOjIsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsImFkZHJlc3MiOiJQaMaw4bubYyBIb8OgLCBUeC4gQuG6v24gQ8OhdCwgQsOsbmggRMawxqFuZywgVmnhu4d0IE5hbSIsImltYWdlIjoiaHR0cHM6Ly9zdGF0aWN2My5tZWV5bWFwLmNvbS9pbWFnZV9jYXB0dXJlL2NhcHR1cmV0ZW1wX2ltYWdlMTczNDg0OTc2NC53ZWJwIn0%26utm_source%3Dzalo%26utm_medium%3Dzalo%26utm_campaign%3Dzalo');
            zaloJSV2.closeWindow(access_token, {});
        }
        function test() {
            var href = window.location.href;
            window.location.href = "https://beta.meeymap.com/tra-cuu-quy-hoach/phuoc-hoa?search=eyJsYXQiOiIxMS4yMzgwODQ0NTU4NjgwNzYiLCJsbmciOiIxMDYuNzIwMTE5MDE4NTkyNDciLCJ0YWIiOjIsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsImFkZHJlc3MiOiJQaMaw4bubYyBIb8OgLCBUeC4gQuG6v24gQ8OhdCwgQsOsbmggRMawxqFuZywgVmnhu4d0IE5hbSIsImltYWdlIjoiaHR0cHM6Ly9zdGF0aWN2My5tZWV5bWFwLmNvbS9pbWFnZV9jYXB0dXJlL2NhcHR1cmV0ZW1wX2ltYWdlMTczNDg0OTc2NC53ZWJwIn0&utm_source=zalo&utm_medium=zalo&utm_campaign=zalo";
        }
        // test();
        function openAppFromZaloIfNeeded() {
            var href = window.location.href;
            
            href = href.replace('https://xuantung95.github.io/open_zalo_link.html?', 'https://beta.meeymap.com/tra-cuu-quy-hoach/huyen-bac-ai?search=eyJsYXQiOjExLjY2MDcxODAyMjQwMzU3MiwibG5nIjoxMDguOTYxNzA1Mjk1NDE0NTYsInRhYiI6MSwic2F0ZWxsaXRlVmlzaWJsZSI6dHJ1ZSwiaW1hZ2UiOiIvaW1hZ2VzL3Nlby1kZWZhdWx0LnBuZyJ9&');
            
            var link = "";
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isAndroid = /Android/i.test(navigator.userAgent);
            const fromZalo = href.includes("utm_source=zalo");
            if (fromZalo) {
                const flavor = "pro";
                var bundleId = "com.meeymap.app.beta";
                if (flavor == "dev") {
                    bundleId = bundleId + ".dev";
                } else if (flavor == "stg") {
                    bundleId = bundleId + ".stg";
                }
                if (isAndroid) {
                    link = href.replace("https://", "intent://")
                    link = link + "#Intent;package=" + bundleId + ";action=android.intent.action.VIEW;scheme=https;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.meeymap.app.beta;end;"
                    window.location.href = link;
                } else if (isIOS) {
                    // link = href.replace("https://", bundleId + "://");
                    link = "https://jp.zaloapp.com/cf?url=" + encodeURIComponent(href)
                    window.location.href = link;
                }
            }
        }

        // openAppFromZaloIfNeeded();

        // window.onload = function() {
        //     openAppFromZaloIfNeeded();
        // };

    </script>
</body>
</html>