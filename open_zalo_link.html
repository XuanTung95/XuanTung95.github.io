<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deeplink Auto Open</title>
</head>
<body>
    <h1>Copy URL to Clipboard</h1>
    <p>Click the button below to copy the current page URL:</p>
    <button onclick="openAppFromZaloIfNeeded()">Copy URL</button>
    <div class="copied" id="copiedText">URL Copied!</div>
    <button onclick="openAppFromZaloIfNeeded()">openMyLink</button>
    <a href="#" class="btn01" onclick="proceed();return false;">Tôi đã hiểu và tiếp tục</a>
    <script>
        function proceed() {
            var url = 'https://staging.meeymap.com/tra-cuu-quy-hoach/tt-lai-uyen?search=eyJsYXQiOjExLjI1NjQ2ODMwMTg1MTA3MiwibG5nIjoxMDYuNTkyNjQ5MzQzNzYxODIsImFkZHJlc3MiOiJUVC4gTGFpIFV5w6puLCBCw6B1IELDoG5nLCBCw6xuaCBExrDGoW5nLCBWaeG7h3QgTmFtIiwiaW1hZ2UiOiJodHRwczovL3N0YXRpY3YzLm1lZXltYXAuY29tL2ltYWdlX2NhcHR1cmUvY2FwdHVyZXRlbXBfaW1hZ2UxNzM0NDg2OTQxLndlYnAiLCJ0YWIiOjAsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsInNoYXJlIjp0cnVlLCJmYWNlYm9vayI6ZmFsc2V9&amp;utm_source=zalo&amp;utm_medium=zalo&amp;utm_campaign=zalo';
            // $.ajax({
            //     url : "/rp?url=https%3A%2F%2Fstaging.meeymap.com%2Ftra-cuu-quy-hoach%2Ftt-lai-uyen%3Fsearch%3DeyJsYXQiOjExLjI1NjQ2ODMwMTg1MTA3MiwibG5nIjoxMDYuNTkyNjQ5MzQzNzYxODIsImFkZHJlc3MiOiJUVC4gTGFpIFV5w6puLCBCw6B1IELDoG5nLCBCw6xuaCBExrDGoW5nLCBWaeG7h3QgTmFtIiwiaW1hZ2UiOiJodHRwczovL3N0YXRpY3YzLm1lZXltYXAuY29tL2ltYWdlX2NhcHR1cmUvY2FwdHVyZXRlbXBfaW1hZ2UxNzM0NDg2OTQxLndlYnAiLCJ0YWIiOjAsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsInNoYXJlIjp0cnVlLCJmYWNlYm9vayI6ZmFsc2V9%26utm_source%3Dzalo%26utm_medium%3Dzalo%26utm_campaign%3Dzalo&key=0&oId=0&ac=go",
            //     type: "POST",
            //     data : "json"
            // });
            // fetch('/at?page=CONFIRM&action=PROCEED&key=0&url=https%3A%2F%2Fstaging.meeymap.com%2Ftra-cuu-quy-hoach%2Ftt-lai-uyen%3Fsearch%3DeyJsYXQiOjExLjI1NjQ2ODMwMTg1MTA3MiwibG5nIjoxMDYuNTkyNjQ5MzQzNzYxODIsImFkZHJlc3MiOiJUVC4gTGFpIFV5w6puLCBCw6B1IELDoG5nLCBCw6xuaCBExrDGoW5nLCBWaeG7h3QgTmFtIiwiaW1hZ2UiOiJodHRwczovL3N0YXRpY3YzLm1lZXltYXAuY29tL2ltYWdlX2NhcHR1cmUvY2FwdHVyZXRlbXBfaW1hZ2UxNzM0NDg2OTQxLndlYnAiLCJ0YWIiOjAsInNhdGVsbGl0ZVZpc2libGUiOnRydWUsInNoYXJlIjp0cnVlLCJmYWNlYm9vayI6ZmFsc2V9%26utm_source%3Dzalo%26utm_medium%3Dzalo%26utm_campaign%3Dzalo');
            
            window.location.href = url;
        }
        function test() {
            var href = window.location.href;
            window.location.href = href;
        }
        // test();
        function openAppFromZaloIfNeeded() {
            var href = window.location.href;
            
            href = href.replace('https://xuantung95.github.io/open_zalo_link.html?', 'https://beta.meeymap.com/tra-cuu-quy-hoach/huyen-bac-ai?search=eyJsYXQiOjExLjY2MDcxODAyMjQwMzU3MiwibG5nIjoxMDguOTYxNzA1Mjk1NDE0NTYsInRhYiI6MSwic2F0ZWxsaXRlVmlzaWJsZSI6dHJ1ZSwiaW1hZ2UiOiIvaW1hZ2VzL3Nlby1kZWZhdWx0LnBuZyJ9&');
            
            var link = "";
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isAndroid = /Android/i.test(navigator.userAgent);
            const fromZalo = href.includes("utm_source=zalo");
            if (fromZalo) {
                const flavor = "pro";
                var bundleId = "com.meeymap.app.beta";
                if (flavor == "dev") {
                    bundleId = bundleId + ".dev";
                } else if (flavor == "stg") {
                    bundleId = bundleId + ".stg";
                }
                if (isAndroid) {
                    link = href.replace("https://", "intent://")
                    link = link + "#Intent;package=" + bundleId + ";action=android.intent.action.VIEW;scheme=https;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.meeymap.app.beta;end;"
                    window.location.href = link;
                } else if (isIOS) {
                    // link = href.replace("https://", bundleId + "://");
                    link = "https://jp.zaloapp.com/cf?url=" + encodeURIComponent(href)
                    window.location.href = link;
                }
            }
        }

        // openAppFromZaloIfNeeded();

        // window.onload = function() {
        //     openAppFromZaloIfNeeded();
        // };

    </script>
</body>
</html>